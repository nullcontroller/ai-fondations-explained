# プロンプト設計と確率空間の考え方（Amazon Q 実装要素対応版）  
― AIは数学で動いている ―  

このドキュメントでは、  
コード生成における **各構成要素（Agent / skill / script / doc / bin）が  
AIの出力をどう変えるのか** を、「確率空間」という考え方で整理します。

※ 内部実装・数式・学習アルゴリズムの説明は行いません。

---

## 結論（先に）

- Amazon Q は **数学的な確率処理装置**
- 各構成要素は    **確率空間を「方向付ける／削る／固定する／膨らませる」役割を持つ**
- 安定したAIとは  **確率空間が整理された状態**のこと

---

## Amazon Q は何をしているのか（数学的に）

Amazon Q は常に次を行っています。

> 「次に出す出力候補」に  
> **確率を割り当て、最も尤もらしいものを選択する**

- 正解を理解している → ✖
- 意味を理解している → ✖  
- 確率が高いものを選んでいる → 〇

---

## 確率空間とは何か（直感的説明）

確率空間とは、

> **Amazon Q が「出し得る回答候補の全集合」**

です。

初期状態では、以下がすべて混在します。

- 正式仕様の説明  
- 一般論  
- 推測  
- 創作的補完  
- 誤解釈  

何もしない場合、**空間は広く、汚れている**

---

## コード生成の構成要素と確率空間への作用
ここでは、業務の都合上、AmazonQを例にします。
しかし、LLMを使ったコード生成である限り、原理は同じです。

---

## ① Agent.md  
### 役割：確率空間の「方向」を決める

#### 何を書くか
- 役割（何者か）
- 目的（何のために存在するか）
- 基本姿勢（どう振る舞うか）

#### 数学的効果
- 出力全体の **方向ベクトル** が固定される  
- 無関係な文体・話題の確率が下がる  

**空間が一方向に傾く**

---

## ② skill  
### 役割：確率空間の「使ってよい操作」を限定する

#### 何を書くか
- 実行してよい能力
- 使用可能な情報源
- 禁止されている行為

#### 数学的効果
- 使用不可な行動パターンの確率がほぼ0になる  
- 回答パターンが限定される  

**空間が削られる**

---

## ③ script  
### 役割：確率空間の「思考手順」を固定する

#### 何を書くか
- 手順
- 判断順序
- 分岐条件

#### 数学的効果
- 出力の流れが毎回似た形になる  
- 思考のブレが減る  

**空間の形状が固定される**

---

## ④ doc  
### 役割：確率空間を「局所的に膨らませる」

#### 何を書くか
- 仕様
- 定義
- 用語説明
- 設計意図

#### 数学的効果
- 関連語彙・事実の確率が一時的に上昇  
- ノイズも同時に入る可能性がある  

**空間が部分的に広がる**

---

## ⑤ bin  
### 役割：確率空間を「現実に接続する」

#### 何を書くか
- 実行可能な処理
- 実データ
- 外部システムとの接点

#### 数学的効果
- 抽象的候補より「実行結果」に引っ張られる  
- 曖昧な回答の確率が下がる  

**空間が現実側に引き寄せられる**

---

## なぜ制約が多いほど賢く見えるのか

制約を加えると、

- 候補が減る  
- 外れ値が消える  
- 最大確率が安定する  

数学的には、**確率分布が整理されただけ**であり、理解力が上がったわけではない。

---

## なぜ doc をそのまま大量に与えると危険か

- doc は人間向けに書かれている  
- 背景・例外・余談が混ざっている  

#### 数学的に起きること
- 無関係な文脈にも確率が割り当てられる  
- 確率分布が汚れる  

**確率空間が広がりすぎる**

---

## 実務での設計指針（超重要）

| 要素 | 確率空間への作用 |
|---|---|
| Agent.md | 方向付け |
| skill | 削減 |
| script | 固定 |
| doc | 局所拡張 |
| bin | 現実接続 |
| 判断 | 人間 |

---

## 重要な一文

**Amazon Q は理解していない。設計された確率空間の中で選んでいるだけ。**

---

## まとめ

- AIは数学  
- Amazon Q 設計は確率設計  
- 良い設計とは  
  **「余計な確率を持たせないこと」**

---