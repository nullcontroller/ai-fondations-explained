# プロンプト設計と確率空間の考え方  
― AIは数学で動いている ―

このドキュメントでは、
AI（ChatGPT 等）が **なぜ制約を書くと安定するのか** を  
「確率空間」という考え方で説明します。

※ 内部実装・数式・学習アルゴリズムの話はしません。

---

## 結論（先に）

- AIは **数学的な確率処理装置**
- プロンプト・Knowledge・RAGは  
  **確率空間を歪めたり、削ったりする操作**
- 良いプロンプトとは  
  **望ましい確率だけが残るように空間を設計すること**

---

## AIは何をしているのか（数学的に）

AIは、常に次のことをしています。

> 「次に出す言葉（トークン）の候補」に  
> **確率を割り当てて、最も尤もらしいものを選ぶ**

これは完全に **数学的な確率選択** です。

- 正解を知っている → ✖
- 意味を理解している → ✖
- 確率が高いものを選んでいる → 〇

---

## 確率空間とは何か（直感的説明）

確率空間とは、

**AIが「あり得る」と考えている回答の全候補集合**です。

LLMの中には、以下の情報が最初は **同じ空間に混ざって存在** しています。

- 技術解説
- 雑談
- 推測
- 一般論
- 創作
- 誤情報
---

## プロンプトの役割＝確率空間の「方向付け」

### 役割指定（Role）

例：
- あなたは業務QAチャットである

#### 数学的効果
- 無関係な候補（雑談・感情表現）の確率が下がる
- 業務的な語彙・文体の確率が上がる

つまり、**空間が一方向に傾く**

---

## 制約の役割＝確率空間の「削減」

### 制約指定（Constraints）

例：
- 推測は禁止
- RAGにない情報は使わない

#### 数学的効果
- 推測・創作に対応する候補が **確率0に近づく**
- 残った候補の中で再正規化される

**回答する空間が狭くなる**

---

## Knowledgeの役割＝確率空間の「固定」

### Knowledgeとは
- 変えてはいけない前提
- 判断してはいけない境界
- 思考の癖の禁止・誘導

#### 数学的効果
- 特定パターンの確率を **恒常的に高く／低く固定**
- 毎回の生成でブレにくくなる

**空間の形が固定される**

---

## RAGの役割＝確率空間の「局所拡張」

### RAGとは
- 外部から一時的に与える事実集合

#### 数学的効果
- 関連語彙・事実の確率が局所的に上昇
- ただしノイズも一緒に入る可能性がある

**空間が部分的に膨らむ**

---

## なぜ制約が多いと「賢く」見えるのか

制約が多いと、

- 候補が減る
- 迷いが減る
- 外れ値が消える

数学的には、

**最大確率の候補が、より安定して選ばれる**だけです。

「理解力が上がった」のではありません。

---

## なぜ仕様書をそのままRAGにすると危ないのか

- 仕様書は人間向けに書かれている
- 判断・背景・余談が混ざっている

#### 数学的に起きること
- 無関係な文脈にも確率が割り当てられる
- 確率分布が汚れる（ノイズが増える）

**確率空間が広がりすぎる**ため、新たなハルシネーションを生む。

---

## 重要な一文

**AIは理解していない。  
確率が歪んだ空間の中で選んでいるだけ。**

---

## 実務での設計指針（超重要）

- プロンプト：方向を決める
- Knowledge：形を固定する
- RAG：必要な事実だけ足す
- 判断：人がやる

---

## まとめ

- AIは数学
- プロンプト設計は確率設計
- 良いAIとは「確率空間がよく設計されたAI」

---